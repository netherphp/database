<?php

require('vendor/autoload.php');

use Nether\Database\Struct\TableClassInfo;

$App = new class extends Nether\Console\Client {

	#[Nether\Console\Meta\Subcommand('sql-create')]
	#[Nether\Console\Meta\Error(1,'no class specified')]
	#[Nether\Console\Meta\Error(2,'class not found')]
	public function
	HandleSqlCreate() {
	/*//
	@date 2021-08-19
	read the class attributes and generate the sql required to create this
	table in the database server.
	//*/

		$Class = $this->GetInput(2);
		$SQL = '';

		////////

		if(!$Class)
		$this->Quit(1);

		$Class = static::TranslateClassName($Class);

		if(!class_exists($Class))
		$this->Quit(2);

		////////

		try {
			$SQL = (
				Nether\Database\Verse::FromMetaCreate($Class)
				->SetPretty(TRUE)
			);
		}

		catch(Throwable $Err) {
			throw $Err;
		}

		echo $SQL, PHP_EOL;

		return;
	}

	static public function
	TranslateClassName(string $Input):
	string {
	/*//
	@date 2021-08-19
	i want to support a few different syntaxes for inputting class names
	since php went with backslashes as namespaceoperators. i said it then,
	and im saying it now. choosing backslashes to avoid extra work rather
	than make it actually be good was fukken stupid.
	//*/

		// Some.Class.Name

		if(str_contains($Input,'.'))
		return str_replace('.','\\',$Input);

		// Some-Class-Name

		if(str_contains($Input,'-'))
		return str_replace('-','\\',$Input);

		return $Input;
	}

};

$App->Run();
